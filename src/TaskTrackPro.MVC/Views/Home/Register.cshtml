@{
    Layout = "_AuthLayout";
}

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
    .role-btn {
        transition: background-color 0.3s, color 0.3s;
    }

    .role-btn.btn-outline-primary {
        background-color: white;
        color: #007bff;
        border: 2px solid #007bff;
    }

    .role-btn.active {
        background-color: #007bff !important;
        color: white !important;
        border: 2px solid #007bff;
    }

    .role-btn:hover {
        background-color: #0056b3 !important;
        color: white !important;
        border: 2px solid #0056b3;
    }

    .error {
        color: red !important;
        font-size: 14px;
        display: block;
        margin-top: 5px;
    }

    .container-box {
        margin-top: 8rem;
        margin-bottom: 3rem;
        max-width: 500px;
    }

    .scrollable-container {
        max-height: 80vh;
        overflow-y: auto;
        padding-right: 10px;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    .scrollable-container::-webkit-scrollbar {
        display: none;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .login-right-wrapper {
        animation: fadeIn 0.8s ease-in-out;
    }
</style>

<div class="d-flex justify-content-center align-items-center vh-100">
    <div class="col-width-50 text-center">
        <img src="~/css/Default/images/register_logo.svg" alt="Register Image">
    </div>
    <div class="container container-box">
        <div class="login-right-wrapper border p-4 shadow-lg rounded">
            <h2 class="text-dark font-bold text-center">Sign Up</h2>
            <div class="scrollable-container">
                <form enctype="multipart/form-data" id="registerForm">
                    <div class="form-group text-center">
                        <button type="button" class="role-btn btn btn-outline-primary active"
                            data-role="Candidate">Candidate</button>
                        <button type="button" class="role-btn btn btn-outline-primary"
                            data-role="Recruiter">Recruiter</button>
                        <input type="hidden" id="role" name="role" value="Candidate">
                    </div>

                    <div class="form-group">
                        <input type="text" class="k-textbox login-textbox" placeholder="Full Name" id="registerfullname"
                            name="registerfullname">
                    </div>

                    <div class="form-group">
                        <input type="text" class="k-textbox login-textbox" placeholder="User Name" id="registername"
                            name="registername">
                    </div>

                    <div class="d-flex justify-content-between gap-2">
                        <div class="form-group w-100">
                            <input type="email" class="k-textbox login-textbox" placeholder="Email" id="registerEmail"
                                name="registerEmail">
                        </div>
                        <div class="form-group w-100">
                            <input type="text" class="k-textbox login-textbox" placeholder="Mobile Number"
                                id="registerMobile" name="registerMobile">
                        </div>
                    </div>

                    <div class="form-group">
                        <input type="password" class="k-textbox login-textbox" placeholder="Password" id="registerpwd"
                            name="registerpwd">
                    </div>

                    <div class="form-group">
                        <input type="password" class="k-textbox login-textbox" placeholder="Confirm Password"
                            id="register_cnf_pwd" name="register_cnf_pwd">
                    </div>

                    <div class="form-group">
                        <div class="d-flex align-items-center form-control login-textbox">
                            <input type="radio" id="male" name="gender" value="Male" class="k-radio">
                            <label for="male" class="k-radio-label mr-3">Male</label>
                            <input type="radio" id="female" name="gender" value="Female" class="k-radio">
                            <label for="female" class="k-radio-label">Female</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <input type="file" id="profilePic" name="profilePic" class="form-control">
                    </div>

                    <div class="form-group pb-10 text-center">
                        <button type="button" id="register" class="btn btn-primary w-100">Submit</button>
                    </div>
                    <div class="text-center">
                        <span class="text-dark font-medium">Already have an account?</span>
                        <a asp-action="Login" class="font-medium text-primary">Login here</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        var notification = $("#notification").kendoNotification({
            position: {
                top: 20,
                left: "70%",
                translateX: "-50%" // Center the notification
            },
            autoHideAfter: 4000, // Show for 2 seconds
            stacking: "down",
            templates: [{
                type: "success",
                template: "<div class='kendo-custom-success'>#= message #</div>" // Fixed template syntax
            }]
        }).data("kendoNotification");

        $('#register').on('click', function () {
            if ($('#registerForm').valid()) {
                saveData();
            }
            else {
                console.log("Validation Error");
            }
        })

        $.validator.addMethod('nameRegex', function (value, element) {
            return this.optional(element) || /^[A-Za-z\s]+$/
                .test(value);
        }, 'Numbers Not Allowed');


        $.validator.addMethod('passRegex', function (value, element) {
            return this.optional(element) || /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!%*?&])[A-Za-z\d!%*?&]{6,}$/.test(value);
        }, 'Password must contain:<br>■ Minimum 6 characters<br>■ At least 1 uppercase letter<br>■ At least 1 lowercase letter<br>■ At least 1 number<br>■ At least 1 special character (!%*?&)');


        $('#registerForm').validate({
            errorClass: 'Error',
            rules: {
                registername: {
                    required: true,
                    nameRegex: true,
                },
                registerEmail: {
                    required: true,
                },
                registerpwd: {
                    required: true,
                    passRegex: true,
                },
                register_cnf_pwd: {
                    required: true,
                    equalTo: '#registerpwd',
                },
                gender: {
                    required: true,
                },
                profilePic: {
                    required: true,
                },
            },
            messages: {
                registername: {
                    required: 'Please Enter Name',
                },
                registerEmail: {
                    required: 'Please Enter Email',
                },
                registerpwd: {
                    required: 'Please Enter Password',
                },
                register_cnf_pwd: {
                    required: 'Please Enter Confirm Password',
                },
                gender: {
                    required: 'Please Select Gender',
                },
                profilePic: {
                    required: 'Please Upload Image',
                },
            },
            errorPlacement: function (error, element) {
                if (element.attr("type") === "radio") {
                    error.appendTo(element.closest(".d-flex"));
                } else {
                    error.insertAfter(element);
                }
            }
        });

        function saveData() {
            var formData = new FormData();
            formData.append("c_uname", $('#registername').val());
            formData.append("c_email", $('#registerEmail').val());
            formData.append("c_password", $('#registerpwd').val());
            formData.append("c_cnf_password", $('#register_cnf_pwd').val());
            formData.append("c_gender", $('input[name="gender"]:checked').val());

            // Append the image file
            var fileInput = $('#profilePic')[0].files[0];
            console.log(fileInput);
            if (fileInput) {
                formData.append("c_profile", fileInput);
            }

            $.ajax({
                url: 'http://localhost:5136/api/UserApi/Register',
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                success: function (response) {
                    // Show Swal alert on success
                    Swal.fire({
                        title: "Success!",
                        text: "User registered successfully!",
                        icon: "success",
                        confirmButtonText: "OK",
                        timer: 2000
                    }).then(() => {
                        // Redirect to Login page after Swal alert
                        window.location = '../Home/Login';
                    });

                    // Clear form data
                    clearData();
                },
                error: function (xhr, status) {
                    console.error("Error while adding the user: " + xhr.responseText);
                    Swal.fire({
                        title: "Error!",
                        text: "User registration failed. Please try again.",
                        icon: "error",
                        confirmButtonText: "OK"
                    });
                }
            });
        };

        function clearData() {
            $('#registername').val("");
            $('#registerEmail').val("");
            $('#registerpwd').val("");
            $('#register_cnf_pwd').val("");
            $('input[name="gender"]').prop("checked", false);
            $('#profilePic').val("");
        }
    });

</script>